<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nebulabs OS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --card:#ffffff;
  --shelf:#ffffff;
  --shelf-text:#000000;
  --text:#202124;
  --accent:#1a73e8;
  --shelf-alpha:1;
  --wallpaper:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
}
.dark{
  --card:#1f1f1f;
  --shelf:#202124;
  --shelf-text:#ffffff;
  --text:#e8eaed;
}
*{margin:0;padding:0;box-sizing:border-box;user-select:none;font-family:system-ui,sans-serif;}
html,body{width:100%;height:100%;overflow:hidden;color:var(--text);}
#desktop{width:100%;height:100%;background:var(--wallpaper);background-size:cover;background-position:center;position:relative;}
#shelf{position:absolute;bottom:0;left:0;right:0;height:64px;background:rgba(var(--shelf-rgb,255,255,255),var(--shelf-alpha));color:var(--shelf-text);display:flex;align-items:center;padding:0 12px;gap:10px;transition:background .25s,color .25s;z-index:1000;}
#launcherBtn{width:48px;height:48px;border-radius:50%;background:#3c4043;color:white;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;}
#launcherBtn::before{content:"N";}
#pinnedAppsDiv{display:flex;gap:8px;}
.shelf-app{width:48px;height:48px;border-radius:12px;background:#3c4043;color:white;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:22px;}
.shelf-app:hover{background:#5f6368;}
#status{margin-left:auto;display:flex;gap:12px;font-size:14px;}
#launcher{position:absolute;bottom:80px;left:16px;width:340px;background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.3);padding:14px;display:none;z-index:1000;}
.app{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;cursor:pointer;}
.app:hover{background:#f1f3f4;}
.dark .app:hover{background:#2a2a2a;}
.icon{width:40px;height:40px;border-radius:10px;background:var(--accent);color:white;display:flex;align-items:center;justify-content:center;font-size:20px;}
.window{position:absolute;width:480px;height:360px;background:var(--card);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden;}
.titlebar{height:40px;background:#f1f3f4;display:flex;align-items:center;padding:0 12px;cursor:move;}
.dark .titlebar{background:#2a2a2a;}
.title{flex:1;font-size:14px;}
.controls span{width:12px;height:12px;border-radius:50%;margin-left:8px;display:inline-block;cursor:pointer;}
.close{background:#ea4335;}
.full{background:#34a853;}
.content{padding:16px;height:calc(100% - 40px);overflow:auto;}
.theme-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:14px;margin-top:12px;}
.theme-tile{height:80px;border-radius:12px;cursor:pointer;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;flex-direction:column;font-size:24px;border:2px solid transparent;}
.theme-tile:hover{border-color:var(--accent);}
#contextMenu{position:absolute;background:var(--card);border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.35);display:none;z-index:9999;}
.ctx-item{padding:10px 14px;cursor:pointer;}
.ctx-item:hover{background:var(--accent);color:white;}
.confetti{position:absolute;border-radius:50%;pointer-events:none;opacity:0.9;animation:confettiFall linear forwards;}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0deg);}100%{transform:translateY(400px) translateX(var(--drift)) rotate(720deg);opacity:0;}}
</style>
</head>
<body>
<div id="desktop"></div>
<div id="launcher"></div>
<div id="shelf">
  <div id="launcherBtn" onclick="toggleLauncher()"></div>
  <div id="pinnedAppsDiv"></div>
  <div id="status">
    <span>üì∂</span>
    <span id="clock"></span>
  </div>
</div>
<input type="file" id="wallpaperInput" accept="image/*" hidden>
<div id="contextMenu"></div>
<script>
let z=10;
const desktop=document.getElementById("desktop");
const launcher=document.getElementById("launcher");
const root=document.documentElement;
const wallpaperInput=document.getElementById("wallpaperInput");
const contextMenu=document.getElementById("contextMenu");
const pinnedAppsDiv=document.getElementById("pinnedAppsDiv");

// ===== THEMES & APPS =====
const themes=["linear-gradient(135deg,#22d3ee,#6366f1)","linear-gradient(135deg,#0ea5e9,#0284c7)","linear-gradient(135deg,#42275a,#734b6d)","linear-gradient(135deg,#000428,#004e92)","linear-gradient(135deg,#232526,#414345)"];
const appIcons={"Files":"üìÅ","Calculator":"üßÆ","Notes":"üìù","Themes":"üé®","App Store":"üõí","Weather":"‚òÄÔ∏è","Music":"üéµ","Paint":"üñåÔ∏è","Mini Game":"üéÆ","Quotes":"üí¨"};
let settings=JSON.parse(localStorage.getItem('nlSettings')||'{}');
settings.pinned=settings.pinned||[];
if(settings.wallpaper) desktop.style.background=settings.wallpaper;
if(settings.dark) root.classList.add('dark');
if(settings.shelfColor) setShelfColor(settings.shelfColor);
if(settings.shelfAlpha) setShelfAlpha(settings.shelfAlpha);
settings.pinned=[...new Set(settings.pinned)].filter(a=>appIcons[a]);
settings.pinned.forEach(pinApp);

// ===== LAUNCHER =====
const appsList=["Files","Calculator","Notes","Themes","App Store"];
launcher.innerHTML=appsList.map(a=>`<div class="app" onclick="openApp('${a}')" oncontextmenu="showPinMenu(event,'${a}')"><div class="icon">${appIcons[a]}</div>${a}</div>`).join("");
function toggleLauncher(){launcher.style.display=launcher.style.display==="block"?"none":"block";}
document.addEventListener('click',e=>{if(!launcher.contains(e.target)&&e.target.id!=="launcherBtn") launcher.style.display='none';});

// ===== CLOCK =====
setInterval(()=>{clock.textContent=new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});},1000);

// ===== WINDOWS =====
function openApp(name){
  launcher.style.display="none";
  const win=document.createElement("div");
  win.className="window"; win.style.left="120px"; win.style.top="90px"; win.style.zIndex=++z;
  win.innerHTML=`<div class="titlebar"><div class="title">${name}</div><div class="controls"><span class="full"></span><span class="close"></span></div></div><div class="content">${getContent(name)}</div>`;
  let fullscreen=false;
  win.querySelector(".full").onclick=()=>{
    fullscreen=!fullscreen;
    if(fullscreen){win.dataset.prev=JSON.stringify({l:win.style.left,t:win.style.top,w:win.style.width,h:win.style.height});Object.assign(win.style,{left:"0",top:"0",width:"100%",height:"100%"});}
    else Object.assign(win.style,JSON.parse(win.dataset.prev));
  };
  win.querySelector(".close").onclick=()=>win.remove();
  makeDraggable(win);
  desktop.appendChild(win);
  if(name==="Paint") initPaint(win.querySelector("#paintCanvas"));
  if(name==="Mini Game") document.getElementById("scoreDisplay").textContent="Score: "+miniScore;
}

// ===== APP CONTENT =====
function getContent(name){
  if(name==="Themes") return `<button onclick="wallpaperInput.click()">Import Wallpaper</button><button onclick="toggleDark()">Toggle Light / Dark</button><h4>Taskbar Color</h4><input type="color" value="#ffffff" onchange="setShelfColor(this.value)" style="width:100%;height:40px;border:none;border-radius:8px"><h4>Transparency</h4><input type="range" min="0.2" max="1" step="0.01" value="1" onchange="setShelfAlpha(this.value)" style="width:100%"><div class="theme-grid">${themes.map(bg=>`<div class="theme-tile" style="background:${bg}" onclick="desktop.style.background='${bg}';settings.wallpaper='${bg}';saveSettings()"></div>`).join("")}</div>`;
  if(name==="Calculator") return `<input id="calcIn" style="width:100%"><button onclick="calc()">=</button><div id="calcOut"></div>`;
  if(name==="Notes") return `<textarea style="width:100%;height:100%"></textarea>`;
  if(name==="Files") return `<p>Demo file system</p>`;
  if(name==="App Store"){
    const apps=[{name:"Weather",icon:"‚òÄÔ∏è"},{name:"Music",icon:"üéµ"},{name:"Paint",icon:"üñåÔ∏è"},{name:"Mini Game",icon:"üéÆ"},{name:"Quotes",icon:"üí¨"}];
    return `<input type="text" id="appSearch" placeholder="Search apps..." style="width:100%;padding:8px;margin-bottom:12px;border-radius:8px;border:1px solid #ccc" oninput="filterApps(this.value)"><div id="appGrid" class="theme-grid">${apps.map(a=>`<div class="theme-tile" onclick="installApp('${a.name}')" title="${a.name}"><div>${a.icon}</div><small>${a.name}</small></div>`).join("")}</div>`;
  }
  if(name==="Weather") return `<p>Weather üå§Ô∏è</p><input type="text" id="weatherCity" placeholder="Enter city" style="width:100%;padding:8px;margin-bottom:8px"><button onclick="showWeather()">Check Weather</button><div id="weatherResult"></div>`;
  if(name==="Music") return `<p>Music üéµ</p><button onclick="playSong()">Play Random Song</button><div id="musicStatus"></div>`;
  if(name==="Paint") return `<canvas id="paintCanvas" width="400" height="300" style="border:1px solid #000"></canvas>`;
  if(name==="Mini Game") return `<p>Mini Game üéÆ: Click to score points!</p><button onclick="scorePoint()">Click me!</button><div id="scoreDisplay">Score: 0</div>`;
  if(name==="Quotes") return `<p>Quotes üí¨</p><button onclick="showQuote()">Show Quote</button><div id="quoteDisplay"></div>`;
  return `<p>App content not available.</p>`;
}

// ===== WALLPAPER =====
wallpaperInput.onchange=e=>{const f=e.target.files[0];if(!f) return; const r=new FileReader();r.onload=()=>{desktop.style.background=`url('${r.result}') center/cover`;settings.wallpaper=desktop.style.background;saveSettings();};r.readAsDataURL(f);};

// ===== DRAG =====
function makeDraggable(win){
  const bar=win.querySelector(".titlebar"); let x=0,y=0,ox=0,oy=0;
  bar.onmousedown=e=>{
    win.style.zIndex=++z;
    ox=win.offsetLeft; oy=win.offsetTop; x=e.clientX; y=e.clientY;
    const onMove=e2=>{win.style.left=ox+(e2.clientX-x)+"px"; win.style.top=oy+(e2.clientY-y)+"px";};
    const onUp=()=>{document.removeEventListener('mousemove',onMove);document.removeEventListener('mouseup',onUp);};
    document.addEventListener('mousemove',onMove); document.addEventListener('mouseup',onUp);
  };
}

// ===== CALCULATOR =====
function calc(){try{calcOut.textContent=eval(calcIn.value);}catch{calcOut.textContent="Error";}}

// ===== DARK MODE =====
function toggleDark(){root.classList.toggle('dark');settings.dark=root.classList.contains('dark');saveSettings();}

// ===== SHELF COLOR/ALPHA =====
function setShelfColor(color){root.style.setProperty('--shelf',color);const r=parseInt(color.substr(1,2),16), g=parseInt(color.substr(3,2),16), b=parseInt(color.substr(5,2),16);root.style.setProperty('--shelf-rgb',`${r},${g},${b}`);const brightness=(r*299+g*587+b*114)/1000;root.style.setProperty('--shelf-text',brightness>140?"#000":"#fff");settings.shelfColor=color;saveSettings();}
function setShelfAlpha(alpha){root.style.setProperty('--shelf-alpha',alpha);settings.shelfAlpha=alpha;saveSettings();}

// ===== CONTEXT MENU =====
desktop.oncontextmenu=e=>{e.preventDefault();contextMenu.innerHTML=`<div class="ctx-item" onclick="openApp('Themes')">Themes</div><div class="ctx-item" onclick="wallpaperInput.click()">Import Wallpaper</div><div class="ctx-item" onclick="toggleDark()">Toggle Light / Dark</div><div class="ctx-item" onclick="resetDesktop()">Reset Desktop</div>`;contextMenu.style.left=e.pageX+"px";contextMenu.style.top=e.pageY+"px";contextMenu.style.display="block";}
window.onclick=()=>contextMenu.style.display="none";

// ===== PIN =====
function showPinMenu(e,appName){e.preventDefault();const pinned=document.getElementById('pin-'+appName);contextMenu.innerHTML=`<div class="ctx-item" onclick="togglePin('${appName}')">${pinned?'Unpin':'Pin'} ${appName}</div>`;contextMenu.style.left=e.pageX+"px";contextMenu.style.top=e.pageY+"px";contextMenu.style.display="block";}
function togglePin(appName){contextMenu.style.display="none";const existing=document.getElementById('pin-'+appName);if(existing){existing.remove();settings.pinned=settings.pinned.filter(a=>a!==appName);}else pinApp(appName);saveSettings();}
function pinApp(appName){if(!appIcons[appName]||document.getElementById('pin-'+appName)) return;const div=document.createElement("div");div.className="shelf-app";div.id='pin-'+appName;div.textContent=appIcons[appName];div.title=appName;div.onclick=()=>openApp(appName);pinnedAppsDiv.appendChild(div);if(!settings.pinned.includes(appName)) settings.pinned.push(appName);}

// ===== LOCAL STORAGE =====
function saveSettings(){localStorage.setItem('nlSettings',JSON.stringify(settings));}

// ===== NEW APPS & FEATURES =====
let miniScore=parseInt(localStorage.getItem("miniScore")||"0");
function scorePoint(){miniScore++;localStorage.setItem("miniScore",miniScore);const el=document.getElementById("scoreDisplay");if(el) el.textContent="Score: "+miniScore;}
function showQuote(){const quotes=["Keep going!","Dream big!","Code is fun!","Never give up!","You got this!"];document.getElementById("quoteDisplay").textContent=quotes[Math.floor(Math.random()*quotes.length)];}
function showWeather(){const city=document.getElementById("weatherCity").value;document.getElementById("weatherResult").textContent="Weather in "+city+": Sunny, 25¬∞C";}
function playSong(){const songs=["üéµ Song A","üéµ Song B","üéµ Song C"];document.getElementById("musicStatus").textContent="Now Playing: "+songs[Math.floor(Math.random()*songs.length)];}
function createConfetti(){const colors=["#ff3c3c","#ffbe3c","#3cff3c","#3c9cff","#ff3cff"];for(let i=0;i<50;i++){const conf=document.createElement("div");conf.className="confetti";conf.style.left=Math.random()*window.innerWidth+"px";conf.style.top="0px";conf.style.width=(5+Math.random()*5)+"px";conf.style.height=(5+Math.random()*5)+"px";conf.style.background=colors[Math.floor(Math.random()*colors.length)];conf.style.setProperty("--drift",(Math.random()*100-50)+"px");conf.style.opacity=Math.random()*0.8+0.5;conf.style.animation=`confettiFall ${3+Math.random()*2}s linear forwards`;desktop.appendChild(conf);setTimeout(()=>conf.remove(),5000);}}
function installApp(appName){if(document.getElementById("pin-"+appName)) return; createConfetti(); pinApp(appName);alert(appName+" installed!");}
function filterApps(query){const tiles=document.querySelectorAll("#appGrid .theme-tile");tiles.forEach(t=>{t.style.display=t.textContent.toLowerCase().includes(query.toLowerCase())?"flex":"none";})}

// ===== PAINT =====
function initPaint(canvas){
  const ctx=canvas.getContext("2d"); let drawing=false; let lastX=0,lastY=0;
  function start(e){drawing=true; const rect=canvas.getBoundingClientRect(); lastX=(e.clientX||e.touches[0].clientX)-rect.left; lastY=(e.clientY||e.touches[0].clientY)-rect.top;}
  function draw(e){if(!drawing)return; const rect=canvas.getBoundingClientRect(); const x=(e.clientX||e.touches[0].clientX)-rect.left; const y=(e.clientY||e.touches[0].clientY)-rect.top; ctx.strokeStyle="#"+Math.floor(Math.random()*16777215).toString(16); ctx.lineWidth=2; ctx.lineJoin="round"; ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(x,y); ctx.stroke(); lastX=x; lastY=y;}
  function stop(){drawing=false;}
  canvas.addEventListener("mousedown",start); canvas.addEventListener("touchstart",start);
  canvas.addEventListener("mousemove",draw); canvas.addEventListener("touchmove",draw);
  canvas.addEventListener("mouseup",stop); canvas.addEventListener("mouseout",stop); canvas.addEventListener("touchend",stop);
  const clearBtn=document.createElement("button"); clearBtn.textContent="Clear Canvas"; clearBtn.onclick=()=>ctx.clearRect(0,0,canvas.width,canvas.height); canvas.parentElement.appendChild(clearBtn);
}

// ===== RESET DESKTOP =====
function resetDesktop(){
  if(!confirm("Reset desktop? This will remove wallpaper, pins, and Mini Game score.")) return;
  settings={pinned:[],dark:false}; localStorage.removeItem("nlSettings"); localStorage.removeItem("miniScore");
  location.reload();
}

// ===== KEYBOARD SHORTCUTS =====
document.addEventListener("keydown",e=>{
  if(e.key==="Escape") launcher.style.display="none";
  if(e.key==="l" && e.ctrlKey) toggleLauncher(); // Ctrl+L to toggle launcher
  if(e.key==="d" && e.ctrlKey) toggleDark(); // Ctrl+D to toggle dark
});
</script>
</body>
</html>
